{% extends "base.html" %}

{% block content %}
<section>
  <div class="container-fluid">
    <div class="row emission-page-top">
      <div class="col-md-4 my-5">
        Hello
      </div>
      <div class="col-md-6 my-5 mx-2">
        <img src="https://res.cloudinary.com/dndmvsjh7/image/upload/v1698285923/emissions-checks_oq7k3u.jpg" class="emission-page-img">
      </div>
    </div>
  </div>
</section>
<section>
<div class="table-responsive table-fixed-head shadow">
<table class="table table-hover table-sm  emissions-table scrollbar">
    <thead>
      <tr>
        <th scope="col">Emission Title</th>
        <th scope="col" class=" hidden-col">Image</th>
        <th scope="col">Emission Type</th>
        <th scope="col">Description</th>
        <th scope="col">Location</th>
        <th scope="col" class=" hidden-col" >Created On</th>
        <th scope="col" class=" hidden-col">Next Check Due</th>
        <th scope="col">Check Status</th>
        <th scope="col" class=" hidden-col">Emission Status</th>
      </tr>
    </thead>
    <tbody>
     

    {% for emission in emission_list %}
    {{ emission.js_data| json_script:"emissionData"}}
    <!-- solution to clickable table rows to modal from Stack Overflow:
    https://stackoverflow.com/questions/18995461/how-can-i-show-data-using-a-modal-when-clicking-a-table-row-using-bootstrap
    -->
        <tr onclick="emissionModal('{{emission.javascript_data|escapejs}}')">
        <th scope="row">{{emission.title}}</th>
        {% if "placeholder" in emission.emission_image.url %}
        <td class="hidden-col"><img src="https://res.cloudinary.com/dndmvsjh7/image/upload/v1698183943/Screenshot_2023-10-24_at_22.45.11_e7ebta.png" class="emissions-img " alt="Image of emission {{emission.title}}"></td>
        {% else %}
        <td class="hidden-col"><img src="{{ emission.emission_image.url }}" class="emissions-img" alt="Image of emission {{emission.title}}"></td>
        {% endif %}
        <td>{{emission.get_emission_type}}</td>
        <td>{{ emission.description }}</td>
        <td>{{emission.location}}</td>
        <!-- formatting dates in Django Template Language. Solution from Stack Overflow and documentation
        https://docs.djangoproject.com/en/dev/ref/settings/#std-setting-DATE_FORMAT
        https://stackoverflow.com/questions/13369493/how-to-format-date-in-different-languages
        -->
        <td class=" hidden-col">{{ emission.created_on | date:'M. d Y'}}</td> 
        <!-- Conditional statement to check emission status. If closed then current and next check
        due dates and check status are superfluos -->
        {% if emission.calculate_status == "Closed" %}
        <td class=" hidden-col blank-td"></td> 
        <td class="blank-td"></td> 
        {% else %} 
        <td class=" hidden-col">{{ emission.next_check_due}}</td>  
        <td class="check_status">{{ emission.calculate_check_complete}}</td>  
        {% endif %}
        <td class=" hidden-col">{{ emission.calculate_status}}</td>        
      </tr>

        {% endfor %}
    </tbody>
  </table>
</div>
</section>
<section>
<!-- hidden input to hold url for emissions detail from javascript -->
  <input type="hidden" id="emissionDetailUrl" data-url="" />
<!-- Modal -->

<div class="modal fade" id="emissionModal" tabindex="-1" role="dialog" aria-labelledby="emissionModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="emissionModalTitle">Modal title</h4>
        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body" id="emissionModalBody">
        ...
      </div>
      <div class="modal-footer">
        <a href="#emissionDetailUrl" class="btn" >Submit {{emission}} Emission Check</a>
        <a href="${allEmissionsUrl}" class="btn" id="emission-detail-a">Go To Emission Detail Page</a>
      </div>
    </div>
  </div>
</div>
      </div>
</section>
{% endblock%}